# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: Event-Driven –ù–ï –ø–æ HTTP

**–î–∞—Ç–∞:** 2025-11-21
**–ü—Ä–∏–Ω—Ü–∏–ø:** Event-Driven –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Redis Pub/Sub, –ù–ï HTTP

---

## üéØ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ö–µ–º–∞

```
Client ‚Üí HTTP ‚Üí API Gateway ‚Üí [Event-Driven –ù–ï –ø–æ HTTP] ‚Üí –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
```

### –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Client  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ HTTP (REST API)
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ API Gateway  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚îú‚îÄ‚ñ∫ HTTP (–¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π)
     ‚îÇ   ‚îî‚îÄ‚ñ∫ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã ‚Üí HTTP Response ‚Üí Client
     ‚îÇ
     ‚îî‚îÄ‚ñ∫ Redis Pub/Sub (Event-Driven, –ù–ï HTTP)
         ‚îî‚îÄ‚ñ∫ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã (Subscribers)
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: HTTP vs Event-Driven

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | HTTP REST | Event-Driven (Pub/Sub) |
|----------------|-----------|------------------------|
| **–ü—Ä–æ—Ç–æ–∫–æ–ª** | HTTP/HTTPS | Redis Pub/Sub |
| **–°–æ–µ–¥–∏–Ω–µ–Ω–∏—è** | 1000/—Å–µ–∫ | 9 (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ) |
| **–ó–∞–¥–µ—Ä–∂–∫–∞** | ~5ms | ~0.5ms |
| **CPU** | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è |
| **RAM** | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è |
| **–°–µ—Ç—å** | –í—ã—Å–æ–∫–∞—è | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è |
| **–ù–∞–≥—Ä—É–∑–∫–∞** | 100% | ~10% |

**–í—ã–≤–æ–¥:** Event-Driven —á–µ—Ä–µ–∑ Redis Pub/Sub —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ **~90%** –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å HTTP REST.

---

## üîÑ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (HTTP)

```
Client ‚Üí HTTP ‚Üí API Gateway ‚Üí HTTP ‚Üí API Auth
                              ‚Üì
                         –û–±—Ä–∞–±–æ—Ç–∫–∞
                              ‚Üì
                         HTTP Response ‚Üí API Gateway ‚Üí Client
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:**
- `POST /api/v1/auth/login` - –Ω—É–∂–Ω—ã —Ç–æ–∫–µ–Ω—ã —Å—Ä–∞–∑—É
- `POST /api/v1/auth/register` - –Ω—É–∂–µ–Ω userId —Å—Ä–∞–∑—É
- `POST /api/v1/auth/verify` - –Ω—É–∂–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–∑—É

### 2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (Event-Driven, –ù–ï HTTP)

```
Client ‚Üí HTTP ‚Üí API Gateway ‚Üí Redis Pub/Sub ‚Üí API Auth
                              ‚Üì
                         HTTP 202 Accepted ‚Üí Client
                              ‚Üì
                         API Auth –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:**
- `POST /api/v1/auth/password-reset/request` - –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å 202
- `POST /api/v1/executions` - –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å 202
- `POST /api/v1/auth/email-verification/send` - –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å 202

### 3. Side Effects (Event-Driven, –ù–ï HTTP)

```
Client ‚Üí HTTP ‚Üí API Gateway ‚Üí HTTP ‚Üí API Auth
                              ‚Üì
                         –û–±—Ä–∞–±–æ—Ç–∫–∞
                              ‚Üì
                         HTTP Response ‚Üí Client
                              ‚Üì
                         Redis Pub/Sub (side effects)
                              ‚Üì
                         API Gateway (Subscriber) ‚Üí –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞
                         Analytics (Subscriber) ‚Üí –¢—Ä–µ–∫–∏–Ω–≥
                         Notifications (Subscriber) ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:**
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ—Å–ª–µ login
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

---

## üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ Workix

### Event-Driven —á–µ—Ä–µ–∑ Redis Pub/Sub (–ù–ï HTTP)

```typescript
// libs/shared/backend/core/src/events/pub-sub-publisher.service.ts
import Redis from 'ioredis';

@Injectable()
export class PubSubPublisherService {
  private readonly redis: Redis;

  async publish(channel: string, event: string, data: unknown): Promise<void> {
    // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Redis Pub/Sub, –ù–ï HTTP
    await this.redis.publish(channel, JSON.stringify({
      event,
      data,
      timestamp: Date.now()
    }));
  }
}
```

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ioredis` –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `PUBLISH` –∫–æ–º–∞–Ω–¥—É Redis (–Ω–µ HTTP)
- ‚úÖ –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `SUBSCRIBE` –∫–æ–º–∞–Ω–¥—É Redis (–Ω–µ HTTP)
- ‚úÖ –ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (~10% –æ—Ç HTTP REST)

---

## üìã –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–∏—Ç–æ–≥–æ–≤–∞—è)

### –°—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Client  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ HTTP (REST API)
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ API Gateway  ‚îÇ
‚îÇ  (Port 7000) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚îú‚îÄ‚ñ∫ HTTP (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
     ‚îÇ   ‚îî‚îÄ‚ñ∫ API Auth (Port 7200)
     ‚îÇ       ‚îî‚îÄ‚ñ∫ HTTP Response ‚Üí Client
     ‚îÇ
     ‚îî‚îÄ‚ñ∫ Redis Pub/Sub (Event-Driven, –ù–ï HTTP)
         ‚îÇ
         ‚îú‚îÄ‚ñ∫ API Auth (Subscriber)
         ‚îú‚îÄ‚ñ∫ Monolith (Subscriber)
         ‚îú‚îÄ‚ñ∫ Notifications (Subscriber)
         ‚îî‚îÄ‚ñ∫ Analytics (Subscriber)
```

### –ö–∞–Ω–∞–ª—ã Redis Pub/Sub (–ù–ï HTTP):

- `user.*` - —Å–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `pipeline.*` - —Å–æ–±—ã—Ç–∏—è –ø–∞–π–ø–ª–∞–π–Ω–æ–≤
- `audit.*` - —Å–æ–±—ã—Ç–∏—è –∞—É–¥–∏—Ç–∞
- `rbac.*` - —Å–æ–±—ã—Ç–∏—è RBAC
- `webhook.*` - —Å–æ–±—ã—Ç–∏—è webhooks

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Event-Driven (–ù–ï HTTP)

1. **–ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:**
   - ~10% –æ—Ç HTTP REST
   - –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ)
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–µ—Ç–µ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞

2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:**
   - –û–¥–∏–Ω publisher, –º–Ω–æ–≥–æ subscribers
   - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã—Ö subscribers
   - –ù–µ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å publishers

3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:**
   - –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ —Ñ–æ–Ω–µ
   - –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –ó–∞–¥–µ—Ä–∂–∫–∞ ~0.5ms (vs ~5ms –¥–ª—è HTTP)
   - –ù–∏–∑–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU –∏ RAM
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ç—å

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

```
Client ‚Üí HTTP ‚Üí API Gateway ‚Üí [Event-Driven –ù–ï –ø–æ HTTP] ‚Üí –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
```

**–ì–¥–µ:**
- **HTTP** - –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (login, register, verify)
- **Event-Driven (Redis Pub/Sub)** - –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏ side effects
- **–ù–ï HTTP** - Event-Driven –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Redis Pub/Sub, –Ω–µ HTTP REST

**–í—ã–≤–æ–¥:** ‚úÖ **–í—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω–∏–º–∞–µ—Ç–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É!**
