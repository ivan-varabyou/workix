# üîç –ê–Ω–∞–ª–∏–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ –º–µ–∂–¥—É Monolith –∏ Auth

**Date:** 2025-01-XX
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

---

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–†–û–í–ï–†–ö–ò

### 1. –û—Ç–ø—Ä–∞–≤–∫–∞ Email/–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### ‚úÖ Auth Service (api-auth)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `EventPublisherService` –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤:
  - `password-reset.service.ts` - –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
  - `email-verification.service.ts` - –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ email
  - `security-code.service.ts` - –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –∫–æ–¥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ `MessageBrokerModule` –ø–æ–¥–∫–ª—é—á–µ–Ω
- ‚úÖ `BullModule.registerQueue('notifications:email')` –Ω–∞—Å—Ç—Ä–æ–µ–Ω

#### ‚úÖ Monolith (api-monolith)
- ‚úÖ **–ù–ï–¢** –æ—Ç–ø—Ä–∞–≤–∫–∏ email –Ω–∞–ø—Ä—è–º—É—é
- ‚úÖ **–ù–ï–¢** `EmailNotificationService` –≤ –∫–æ–¥–µ
- ‚úÖ **–ù–ï–¢** `MessageBrokerModule` –∏–ª–∏ `EventPublisherService`
- ‚úÖ **–ù–ï–¢** –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–í—ã–≤–æ–¥:** ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ù–ï–¢. –ú–æ–Ω–æ–ª–∏—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

---

### 2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

#### ‚úÖ Auth Service (api-auth)
- ‚úÖ –ü–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
  - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, logout
  - JWT —Ç–æ–∫–µ–Ω—ã, refresh tokens
  - OAuth2 (Google, GitHub, Apple)
  - 2FA, Phone OTP
  - Password reset, email verification
  - Security codes

#### ‚úÖ Monolith (api-monolith)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ `JwtGuard` –∏–∑ `@workix/domain/auth`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `AuthClientModule` –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ **–ù–ï–¢** —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ **–ù–ï–¢** –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

**–í—ã–≤–æ–¥:** ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ù–ï–¢. –ú–æ–Ω–æ–ª–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã.

---

### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

#### ‚úÖ Auth Service (api-auth)
- ‚úÖ `UsersController` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ `UserProfileService` –∏–∑ `@workix/domain/users`

#### ‚úÖ Monolith (api-monolith)
- ‚úÖ **–ù–ï–¢** Users Controller (—É–¥–∞–ª–µ–Ω —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º –≤ –∫–æ–¥–µ)
- ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ `app.module.ts`: "Users endpoints are in Auth API, not in monolith"
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `UserClientService` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ HTTP

**–í—ã–≤–æ–¥:** ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ù–ï–¢. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Ç–æ–ª—å–∫–æ –≤ Auth API.

---

### 4. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

#### ‚úÖ Auth Service (api-auth)
- ‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (security codes, threat detection)

#### ‚úÖ Monolith (api-monolith)
- ‚úÖ Pipelines (—Å–æ–∑–¥–∞–Ω–∏–µ, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
- ‚úÖ RBAC (—Ä–æ–ª–∏, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è)
- ‚úÖ Workers (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã)
- ‚úÖ Integrations (–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã, credentials)
- ‚úÖ Analytics, E-commerce, Generation
- ‚úÖ A/B Testing, Monitoring

**–í—ã–≤–æ–¥:** ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ù–ï–¢. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ–±–ª—é–¥–µ–Ω–æ.

---

## üìã –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### ‚úÖ –í—Å–µ —Ö–æ—Ä–æ—à–æ!

1. **–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
   - ‚úÖ Auth —Å–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç EventPublisher ‚Üí Queue ‚Üí api-notifications
   - ‚úÖ –ú–æ–Ω–æ–ª–∏—Ç –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é
   - ‚úÖ –ï—Å–ª–∏ –º–æ–Ω–æ–ª–∏—Ç—É –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ pipeline), –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `EventPublisherService`

2. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
   - ‚úÖ –ü–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ç–æ–ª—å–∫–æ –≤ Auth —Å–µ—Ä–≤–∏—Å–µ
   - ‚úÖ –ú–æ–Ω–æ–ª–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã

3. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:**
   - ‚úÖ –¢–æ–ª—å–∫–æ –≤ Auth API
   - ‚úÖ –ú–æ–Ω–æ–ª–∏—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## üéØ –ò–¢–û–ì–û–í–´–ô –í–´–í–û–î

**‚úÖ –î–£–ë–õ–ò–†–û–í–ê–ù–ò–Ø –õ–û–ì–ò–ö–ò –ù–ï–¢!**

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è:
- Auth —Å–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- Monolith –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (pipelines, integrations, etc.)
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ–±–ª—é–¥–µ–Ω–æ
- –í—Å–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–±—â–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–∑ `libs/`

---

## üí° –í–û–ó–ú–û–ñ–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

–ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –º–æ–Ω–æ–ª–∏—Ç—É –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ pipeline –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π), –Ω—É–∂–Ω–æ:

1. –î–æ–±–∞–≤–∏—Ç—å `MessageBrokerModule` –≤ `apps/api-monolith/src/app/app.module.ts`
2. –î–æ–±–∞–≤–∏—Ç—å `BullModule.registerQueue({ name: 'notifications:email' })`
3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä `EventPublisherService`
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `EventPublisherService` –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö –º–æ–Ω–æ–ª–∏—Ç–∞

–ù–æ —Å–µ–π—á–∞—Å —ç—Ç–æ **–ù–ï –ù–£–ñ–ù–û**, —Ç–∞–∫ –∫–∞–∫ –º–æ–Ω–æ–ª–∏—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
