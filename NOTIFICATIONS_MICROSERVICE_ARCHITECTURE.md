# ๐ง ะะธะบัะพัะตัะฒะธั ะฃะฒะตะดะพะผะปะตะฝะธะน - ะััะธัะตะบัััะฐ

## ๐ฏ ะฆะตะปั

ะัะฝะตััะธ ะพัะฟัะฐะฒะบั email ัะฒะตะดะพะผะปะตะฝะธะน ะฒ ะพัะดะตะปัะฝัะน ะผะธะบัะพัะตัะฒะธั `api-notifications` ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ ะพัะตัะตะดะธ ัะพะฑััะธะน (Redis/Bull) ะดะปั:
- ะะฐะทะณััะทะบะธ ะพัะฝะพะฒะฝะพะณะพ ะฟัะธะปะพะถะตะฝะธั (auth, monolith)
- ะัะธะฝััะพะฝะฝะพะน ะพะฑัะฐะฑะพัะบะธ ัะฒะตะดะพะผะปะตะฝะธะน
- ะะฐัััะฐะฑะธััะตะผะพััะธ (ะฝะตัะบะพะปัะบะพ workers)
- ะะฐะดะตะถะฝะพััะธ (retry ะผะตัะฐะฝะธะทะผ)

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ
โ   Auth Service  โ
โ  (api-auth)     โ
โโโโโโโโโโฌโโโโโโโโโโ
         โ
         โ publishNotification()
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  EventPublisher โ
โ    Service      โ
โโโโโโโโโโฌโโโโโโโโโโ
         โ
         โ Bull Queue
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  Redis Queue    โ
โ notifications:  โ
โ     email       โ
โโโโโโโโโโฌโโโโโโโโโโ
         โ
         โ Process jobs
         โผ
โโโโโโโโโโโโโโโโโโโ
โ api-notificationsโ
โ    Service      โ
โ                 โ
โ  EmailProcessor โ
โ    (Worker)     โ
โโโโโโโโโโฌโโโโโโโโโโ
         โ
         โ SendGrid API
         โผ
โโโโโโโโโโโโโโโโโโโ
โ    SendGrid     โ
โ   (Email API)   โ
โโโโโโโโโโโโโโโโโโโ
```

## ๐ ะะพะผะฟะพะฝะตะฝัั

### 1. EventPublisherService (libs/shared/backend/core)
- ะัะฑะปะธะบัะตั ัะพะฑััะธั ะฒ ะพัะตัะตะดั Redis/Bull
- ะัะฟะพะปัะทัะตััั ะฒ auth ัะตัะฒะธัะต ะดะปั ะพัะฟัะฐะฒะบะธ ัะพะฑััะธะน
- ะะต ะฑะปะพะบะธััะตั ะพัะฝะพะฒะฝะพะน ะฟะพัะพะบ

### 2. Notification Events DTOs
- ะขะธะฟะธะทะธัะพะฒะฐะฝะฝัะต ัะพะฑััะธั ะดะปั ัะฐะทะฝัั ัะธะฟะพะฒ ัะฒะตะดะพะผะปะตะฝะธะน
- Email verification, password reset, security code, etc.

### 3. api-notifications ะะธะบัะพัะตัะฒะธั
- ะัะดะตะปัะฝัะน NestJS ัะตัะฒะธั
- ะะฑัะฐะฑะฐััะฒะฐะตั ัะพะฑััะธั ะธะท ะพัะตัะตะดะธ
- ะัะฟัะฐะฒะปัะตั email ัะตัะตะท SendGrid

### 4. EmailProcessor (Worker)
- ะะฑัะฐะฑะฐััะฒะฐะตั ัะพะฑััะธั ะธะท ะพัะตัะตะดะธ
- ะัะฟะพะปัะทัะตั EmailNotificationService ะดะปั ะพัะฟัะฐะฒะบะธ
- Retry ะผะตัะฐะฝะธะทะผ ะฟัะธ ะพัะธะฑะบะฐั

## ๐ ะะพัะพะบ ะดะฐะฝะฝัั

1. **Auth Service** ะณะตะฝะตัะธััะตั ัะพะฑััะธะต (ะฝะฐะฟัะธะผะตั, password reset)
2. **EventPublisherService** ะฟัะฑะปะธะบัะตั ัะพะฑััะธะต ะฒ ะพัะตัะตะดั Redis
3. **api-notifications** ะฟะพะปััะฐะตั ัะพะฑััะธะต ะธะท ะพัะตัะตะดะธ
4. **EmailProcessor** ะพะฑัะฐะฑะฐััะฒะฐะตั ัะพะฑััะธะต ะธ ะพัะฟัะฐะฒะปัะตั email
5. ะะตะทัะปััะฐั ะปะพะณะธััะตััั (ััะฟะตั/ะพัะธะฑะบะฐ)

## โ ะัะตะธะผััะตััะฒะฐ

- **ะัะธะฝััะพะฝะฝะพััั**: Auth ัะตัะฒะธั ะฝะต ะฑะปะพะบะธััะตััั ะพัะฟัะฐะฒะบะพะน email
- **ะะฐัััะฐะฑะธััะตะผะพััั**: ะะพะถะฝะพ ะทะฐะฟัััะธัั ะฝะตัะบะพะปัะบะพ workers
- **ะะฐะดะตะถะฝะพััั**: Retry ะผะตัะฐะฝะธะทะผ ะฟัะธ ะพัะธะฑะบะฐั
- **ะะฐะทะดะตะปะตะฝะธะต ะพัะฒะตัััะฒะตะฝะฝะพััะธ**: ะฃะฒะตะดะพะผะปะตะฝะธั ะพัะดะตะปะตะฝั ะพั ะฑะธะทะฝะตั-ะปะพะณะธะบะธ
- **ะะพะฝะธัะพัะธะฝะณ**: ะะพะถะฝะพ ะพััะปะตะถะธะฒะฐัั ะพัะตัะตะดั ัะตัะตะท Bull Board

## ๐ ะขะธะฟั ัะพะฑััะธะน

- `email_verification` - ะฒะตัะธัะธะบะฐัะธั email
- `password_reset` - ัะฑัะพั ะฟะฐัะพะปั
- `security_code` - ะบะพะด ะฑะตะทะพะฟะฐัะฝะพััะธ
- `welcome` - ะฟัะธะฒะตัััะฒะตะฝะฝะพะต ะฟะธััะผะพ
- `alert` - ัะฒะตะดะพะผะปะตะฝะธั ะพะฑ ะฐะปะตััะฐั
- `digest` - ะดะฐะนะดะถะตัั ะพััะตัั

## ๐ ะกะปะตะดัััะธะต ัะฐะณะธ

1. โ ะกะพะทะดะฐัั EventPublisherService
2. โ ะกะพะทะดะฐัั DTO ะดะปั ัะพะฑััะธะน
3. โณ ะกะพะทะดะฐัั ััััะบัััั api-notifications
4. โณ ะกะพะทะดะฐัั EmailProcessor
5. โณ ะะฝัะตะณัะธัะพะฒะฐัั ะฒ auth ัะตัะฒะธั
6. โณ ะะพะฑะฐะฒะธัั ะผะพะฝะธัะพัะธะฝะณ ะพัะตัะตะดะธ

