# üåç –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ - –°–≤–æ–¥–∫–∞

**–î–∞—Ç–∞:** 2025-11-17
**–í–µ—Ä—Å–∏—è:** 1.0

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã –ø–æ IP –∞–¥—Ä–µ—Å—É (ipapi.co, ip-api.com)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ IP –∞–¥—Ä–µ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä–∞–Ω—ã (–≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—ã—á–Ω–æ –∑–∞—Ö–æ–¥–∏—Ç)

### 2. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π
- ‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–º–µ–Ω—ã —Å—Ç—Ä–∞–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ë–µ–ª–∞—Ä—É—Å—å ‚Üí –ì–µ—Ä–º–∞–Ω–∏—è)
- ‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–µ–æ–±—ã—á–Ω–æ–π —Å–º–µ–Ω—ã —Å—Ç—Ä–∞–Ω—ã (–ø–æ—Å–ª–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ—Ä—ã–≤–∞)
- ‚úÖ –ú–∏–Ω–∏–º—É–º 3 –≤—Ö–æ–¥–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è baseline

### 3. –ó–∞—â–∏—Ç–Ω—ã–µ –∫–æ–¥—ã
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 6-–∑–Ω–∞—á–Ω—ã—Ö –∫–æ–¥–æ–≤
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ –Ω–∞ email —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ (3 –ø–æ–ø—ã—Ç–∫–∏, 15 –º–∏–Ω—É—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è)
- ‚úÖ Endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ª–æ–≥–∏–Ω–∞

### 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (20 IP locations, 50 security events)
- ‚úÖ –°–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è (30 –¥–Ω–µ–π –¥–ª—è IP, 14 –¥–Ω–µ–π –¥–ª—è —Å–æ–±—ã—Ç–∏–π)
- ‚úÖ –ë–∞—Ç—á–∏–Ω–≥ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ (–ø–æ 100 –∑–∞–ø–∏—Å–µ–π)

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ—Ä–º–∞–ª—å–Ω—ã–π –≤—Ö–æ–¥ (–±–µ–∑ –∞–Ω–æ–º–∞–ª–∏–∏)
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–æ–≥–∏–Ω–∏—Ç—Å—è –∏–∑ –æ–±—ã—á–Ω–æ–π —Å—Ç—Ä–∞–Ω—ã
2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
3. –ê–Ω–æ–º–∞–ª–∏—è –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞
4. –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–æ–∫–µ–Ω—ã, –≤—Ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (—Å–º–µ–Ω–∞ —Å—Ç—Ä–∞–Ω—ã)
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–æ–≥–∏–Ω–∏—Ç—Å—è –∏–∑ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ì–µ—Ä–º–∞–Ω–∏—è –≤–º–µ—Å—Ç–æ –ë–µ–ª–∞—Ä—É—Å–∏)
2. –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∞–Ω–æ–º–∞–ª–∏—é –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∑–∞—â–∏—Ç–Ω—ã–π –∫–æ–¥
4. –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—Ç–≤–µ—Ç –ë–ï–ó —Ç–æ–∫–µ–Ω–æ–≤:
   {
     "user": {...},
     "requiresSecurityCode": true,
     "securityCodeExpiresAt": "2025-11-17T23:00:00Z",
     "message": "–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞. –ö–æ–¥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ email..."
   }
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥ —á–µ—Ä–µ–∑ POST /auth/security/verify-code
7. –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–æ–∫–µ–Ω—ã
```

---

## üì° API Endpoints

### POST /api-auth/v1/auth/login
**–û–ø–∏—Å–∞–Ω–∏–µ:** –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏

**–û—Ç–≤–µ—Ç –ø—Ä–∏ –∞–Ω–æ–º–∞–ª–∏–∏:**
```json
{
  "user": {
    "id": "...",
    "email": "user@example.com",
    ...
  },
  "requiresSecurityCode": true,
  "securityCodeExpiresAt": "2025-11-17T23:00:00Z",
  "message": "–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞..."
}
```

### POST /api-auth/v1/auth/security/verify-code
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç–Ω–æ–≥–æ –∫–æ–¥–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ª–æ–≥–∏–Ω–∞

**Request:**
```json
{
  "email": "user@example.com",
  "code": "123456"
}
```

**Response:**
```json
{
  "tokens": {
    "accessToken": "...",
    "refreshToken": "...",
    "expiresIn": 3600
  },
  "user": {...},
  "message": "Login completed successfully"
}
```

### POST /api-auth/v1/auth/security/resend-code
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—â–∏—Ç–Ω–æ–≥–æ –∫–æ–¥–∞

**Request:**
```json
{
  "email": "user@example.com"
}
```

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏:
1. **UserIpLocation** - –∏—Å—Ç–æ—Ä–∏—è IP –∞–¥—Ä–µ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **SecurityVerificationCode** - –∑–∞—â–∏—Ç–Ω—ã–µ –∫–æ–¥—ã –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:
- IP locations —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π —É–¥–∞–ª—è—é—Ç—Å—è
- Security events —Å—Ç–∞—Ä—à–µ 14 –¥–Ω–µ–π —É–¥–∞–ª—è—é—Ç—Å—è
- –ò—Å—Ç–µ–∫—à–∏–µ –∫–æ–¥—ã —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ú–∞–∫—Å–∏–º—É–º 20 IP locations –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ú–∞–∫—Å–∏–º—É–º 50 security events –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üìß Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç email —Å:
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º –æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ (—Å—Ç—Ä–∞–Ω–∞)
- IP –∞–¥—Ä–µ—Å–æ–º
- 6-–∑–Ω–∞—á–Ω—ã–º –∫–æ–¥–æ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∫–æ–¥–∞

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∞–Ω–æ–º–∞–ª–∏–π:
- `MIN_LOGINS_FOR_BASELINE`: 3 (–º–∏–Ω–∏–º—É–º –≤—Ö–æ–¥–æ–≤ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è baseline)
- `ANOMALY_THRESHOLD_HOURS`: 24 (–æ–∫–Ω–æ –¥–ª—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Å–º–µ–Ω—ã —Å—Ç—Ä–∞–Ω—ã)

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞—â–∏—Ç–Ω—ã—Ö –∫–æ–¥–æ–≤:
- –î–ª–∏–Ω–∞ –∫–æ–¥–∞: 6 —Ü–∏—Ñ—Ä
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 15 –º–∏–Ω—É—Ç
- –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫: 3

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö:
- –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—á–∏—Å—Ç–∫–∏: 2 —á–∞—Å–∞
- IP locations: 30 –¥–Ω–µ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è, –º–∞–∫—Å. 20 –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- Security events: 14 –¥–Ω–µ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è, –º–∞–∫—Å. 50 –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–±–æ—Ä–∞ –∫–æ–¥–æ–≤**: –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏
2. **–í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ**: –ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 15 –º–∏–Ω—É—Ç
3. **–û–¥–Ω–æ—Ä–∞–∑–æ–≤–æ—Å—Ç—å**: –ö–æ–¥ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

---

## üìä –û–∂–∏–¥–∞–µ–º–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏

- **IP Locations**: ~70% —Å–Ω–∏–∂–µ–Ω–∏–µ (30 –¥–Ω–µ–π –≤–º–µ—Å—Ç–æ 90, 20 –≤–º–µ—Å—Ç–æ 50 –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- **Security Events**: ~65% —Å–Ω–∏–∂–µ–Ω–∏–µ (14 –¥–Ω–µ–π –≤–º–µ—Å—Ç–æ 30, 50 –≤–º–µ—Å—Ç–æ 100 –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- **–û–±—â–µ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ**: ~60-70% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ –¥–ª—è security –¥–∞–Ω–Ω—ã—Ö

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ

