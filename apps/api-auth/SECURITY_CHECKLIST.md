# ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ API Auth Service

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-17
**–í–µ—Ä—Å–∏—è:** 1.0

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### JWT —Ç–æ–∫–µ–Ω—ã
- [x] JWT_SECRET –∏–º–µ–µ—Ç –º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞
- [x] –¢–æ–∫–µ–Ω—ã –∏–º–µ—é—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (expiresIn)
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º refresh tokens
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω blacklist –¥–ª—è –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401
- [x] ‚úÖ **–ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û**: –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏ JWT - HS256 (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –Ω–µ "none")
- [ ] ‚ùå **–ü–†–û–ë–õ–ï–ú–ê**: –ó–∞—â–∏—Ç–∞ –æ—Ç replay-–∞—Ç–∞–∫ –¥–ª—è access —Ç–æ–∫–µ–Ω–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - —Ç–æ–∫–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ logout

### –ü–∞—Ä–æ–ª–∏
- [x] –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è: 12 —Å–∏–º–≤–æ–ª–æ–≤
- [x] –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: –≤–µ—Ä—Ö–Ω–∏–π/–Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä, —Ü–∏—Ñ—Ä—ã, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã
- [x] –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é bcrypt
- [x] –ó–∞—â–∏—Ç–∞ –æ—Ç —É—Ç–µ—á–∫–∏ –ø–∞—Ä–æ–ª–µ–π –≤ –ª–æ–≥–∞—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã –æ—Ç timing attacks (—Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏)
- [ ] –ü–æ–ª–∏—Ç–∏–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø–∞—Ä–æ–ª–µ–π (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞)

### OAuth2
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω OAuth2 flow –¥–ª—è Google, GitHub, Apple
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ state –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (—Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏)
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã –æ—Ç CSRF –≤ OAuth2 flow (—Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏)

### –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (2FA)
- [x] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è TOTP —Å–µ–∫—Ä–µ—Ç–æ–≤
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è TOTP –∫–æ–¥–æ–≤
- [x] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è backup –∫–æ–¥–æ–≤
- [x] ‚úÖ **–ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û**: Rate limiting –¥–ª—è 2FA –Ω–∞—Å—Ç—Ä–æ–µ–Ω (10 req/min –≤ middleware)

---

## üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫

### Brute Force Protection
- [x] –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
- [x] –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (lockout duration: 15 –º–∏–Ω—É—Ç)
- [x] –°—á–µ—Ç—á–∏–∫ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ (MAX_FAILED_ATTEMPTS: 5)
- [x] –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
- [x] –í–æ–∑–≤—Ä–∞—Ç 401 –ø—Ä–∏ –Ω–µ–≤–µ—Ä–Ω—ã—Ö —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### Rate Limiting
- [x] –õ–∏–º–∏—Ç—ã –¥–ª—è login/register: 5 req/min
- [x] –õ–∏–º–∏—Ç—ã –¥–ª—è password reset: 3 req/min
- [x] –õ–∏–º–∏—Ç—ã –¥–ª—è 2FA: 10 req/min
- [x] –õ–∏–º–∏—Ç—ã –¥–ª—è –æ–±—â–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤: 100 req/min
- [x] –í–æ–∑–≤—Ä–∞—Ç 429 –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤
- [x] Rate limiting middleware —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### Enumeration Attacks
- [x] –ó–∞—â–∏—Ç–∞ –æ—Ç email enumeration –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –ø–∞—Ä–æ–ª—è (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –æ—Ç–≤–µ—Ç)
- [ ] ‚ùå **–ü–†–û–ë–õ–ï–ú–ê**: Email enumeration –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ - —Ä–∞–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (409 vs 201)
- [x] –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö/–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö email –ø—Ä–∏ password reset

### Timing Attacks
- [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ crypto.timingSafeEqual –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è service key
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã –æ—Ç timing attacks –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª–µ–π (bcrypt –¥–æ–ª–∂–µ–Ω –∑–∞—â–∏—â–∞—Ç—å)
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã –æ—Ç timing attacks –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç–æ–∫–µ–Ω–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏)

---

## ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### Email –≤–∞–ª–∏–¥–∞—Ü–∏—è
- [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ @IsEmail() –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞
- [x] –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è email (lowercase, trim)
- [x] ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**: –í–∞–ª–∏–¥–∞—Ü–∏—è email —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ)
- [x] –ö–∞—Å—Ç–æ–º–Ω—ã–π –≤–∞–ª–∏–¥–∞—Ç–æ—Ä IsValidEmail —Å–æ–∑–¥–∞–Ω
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ email –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ (register –∏ login)
- [x] ‚úÖ **–ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ email –∑–∞—â–∏—â–µ–Ω–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î (Prisma –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–æ 255 —Å–∏–º–≤–æ–ª–æ–≤, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500 –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏)
- [x] ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**: Email injection (CRLF) - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–∞—Å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

### –ü–∞—Ä–æ–ª—å –≤–∞–ª–∏–¥–∞—Ü–∏—è
- [x] –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 12 —Å–∏–º–≤–æ–ª–æ–≤
- [x] –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: –≤–µ—Ä—Ö–Ω–∏–π/–Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä, —Ü–∏—Ñ—Ä—ã, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã
- [x] –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 128 —Å–∏–º–≤–æ–ª–æ–≤
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400 –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º –ø–∞—Ä–æ–ª–µ)
- [x] ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã –æ—Ç common passwords (–¥–æ–±–∞–≤–ª–µ–Ω–∞)

### –û–±—â–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ class-validator
- [x] –ó–∞—â–∏—Ç–∞ –æ—Ç SQL injection (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Prisma ORM)
- [x] –ó–∞—â–∏—Ç–∞ –æ—Ç NoSQL injection (–Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PostgreSQL)
- [x] –ó–∞—â–∏—Ç–∞ –æ—Ç XSS –≤ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ sanitization)
- [x] ‚úÖ **–ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û**: Command injection - –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è exec/spawn/shell/system –≤ –∫–æ–¥–µ (—Ç–æ–ª—å–∫–æ –≤ —Ç–µ—Å—Ç–∞—Ö)

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å API

### Security Headers
- [x] X-Content-Type-Options: nosniff
- [x] X-Frame-Options: DENY
- [x] X-XSS-Protection: 1; mode=block
- [x] Referrer-Policy: strict-origin-when-cross-origin
- [x] Strict-Transport-Security (—Ç–æ–ª—å–∫–æ –≤ production)
- [ ] Content-Security-Policy (–Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ –¥–ª—è API)

### CORS
- [x] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] Whitelist —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö origins (localhost:7300, localhost:7301)
- [x] Access-Control-Allow-Credentials: true
- [ ] ‚ö†Ô∏è **–í–û–ü–†–û–°**: CORS –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç whitelist origins –¥–ª—è –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö origins (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏)

### Service Authentication
- [x] ServiceAuthGuard —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è X-Service-Key
- [x] Timing-safe —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ service key
- [x] –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–¥–µ–ª–∫–∏ service key
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Bearer —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üóÑÔ∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### SQL Injection
- [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Prisma ORM (–∑–∞—â–∏—Ç–∞ –æ—Ç SQL injection)
- [x] –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Prisma)
- [x] –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏ SQL –∑–∞–ø—Ä–æ—Å–æ–≤

### –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [x] –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä–æ–ª–µ–π –≤ –ª–æ–≥–∞—Ö
- [x] –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ª–æ–≥–∞—Ö (–≤ production)
- [x] –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ dev —Ä–µ–∂–∏–º–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)

---

## üìù –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [x] Generic error messages –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [x] –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ —Ç–æ–ª—å–∫–æ –≤ development
- [x] –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ stack traces –≤ production
- [x] –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É—Ç–µ—á–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –æ—à–∏–±–∫–∞—Ö

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä–æ–ª–µ–π –≤ –ª–æ–≥–∞—Ö
- [x] –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ª–æ–≥–∞—Ö (–≤ production)
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ security events (failed login attempts)
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ password reset requests

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

### Environment Variables
- [x] –ù–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö required env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (AuthConfigService)
- [x] –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –∫–æ–¥–µ
- [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ .env —Ñ–∞–π–ª–æ–≤ (–Ω–µ –≤ git)

### Secrets Management
- [x] JWT_SECRET —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [x] SERVICE_KEY —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [x] –†–∞–∑–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è dev/prod (—á–µ—Ä–µ–∑ env)
- [ ] –†–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞)

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –£—è–∑–≤–∏–º–æ—Å—Ç–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ (npm audit)
- [x] ‚ùå **–ù–ê–ô–î–ï–ù–û**: –£—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö:
  - glob 10.3.7-11.0.3 (High) - Command injection
  - js-yaml <3.14.2 || >=4.0.0 <4.1.1 (Moderate) - Prototype pollution
  - koa 3.0.1-3.0.2 (Moderate) - Open Redirect
- [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ trusted packages
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ security patches (—Ç—Ä–µ–±—É–µ—Ç npm audit fix)

---

## üö® –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### Critical (P0)
1. ‚úÖ **Email –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞**
   - –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∏–Ω—è—Ç email "invalid-email" –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ email –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ (register –∏ login)
   - –§–∞–π–ª—ã:
     - `apps/api-auth/src/auth/controllers/auth.controller.ts`
     - `libs/domain/auth/src/validators/email.validator.ts`
   - –°—Ç–∞—Ç—É—Å: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### High (P1)
1. ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç common passwords –¥–æ–±–∞–≤–ª–µ–Ω–∞**
   - –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –∏–∑ 100+ common passwords –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ PasswordService
   - –§–∞–π–ª—ã:
     - `libs/domain/auth/src/data/common-passwords.ts`
     - `libs/domain/auth/src/services/password.service.ts`
   - –°—Ç–∞—Ç—É—Å: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

2. ‚ö†Ô∏è **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –ø–∞—Ä–æ–ª–µ–π**
   - –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –ø–∞—Ä–æ–ª–∏
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ö–µ—à–µ–π –ø–æ—Å–ª–µ–¥–Ω–∏—Ö N –ø–∞—Ä–æ–ª–µ–π

### Medium (P2)
1. ‚úÖ **Email enumeration –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ - –ò–°–ü–†–ê–í–õ–ï–ù–û**
   - –ü—Ä–æ–±–ª–µ–º–∞: –†–∞–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö (409) –∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö (201) email
   - –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –æ–±–æ–∏—Ö —Å–ª—É—á–∞–µ–≤
   - –§–∞–π–ª: `apps/api-auth/src/auth/controllers/auth.controller.ts`
   - –°—Ç–∞—Ç—É—Å: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

2. ‚úÖ **Email injection (CRLF) - –ò–°–ü–†–ê–í–õ–ï–ù–û**
   - –ü—Ä–æ–±–ª–µ–º–∞: Email —Å CRLF –∏–Ω—ä–µ–∫—Ü–∏–µ–π (`test%0d%0a@example.com`) –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–∞—Å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
   - –§–∞–π–ª: `apps/api-auth/src/auth/controllers/auth.controller.ts`
   - –°—Ç–∞—Ç—É—Å: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

3. ‚ùå **JWT replay attack –¥–ª—è access —Ç–æ–∫–µ–Ω–æ–≤**
   - –ü—Ä–æ–±–ª–µ–º–∞: Access —Ç–æ–∫–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ logout (blacklist –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ JwtStrategy)
   - –†–∏—Å–∫: –ü–æ—Å–ª–µ logout –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è (1 —á–∞—Å)
   - –†–µ—à–µ–Ω–∏–µ: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å JwtBlacklistService –≤ JwtStrategy –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ blacklist –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞
   - –§–∞–π–ª—ã:
     - `libs/domain/auth/src/strategies/jwt.strategy.ts`
     - `libs/domain/auth/src/services/jwt-blacklist.service.ts`
   - –°—Ç–∞—Ç—É—Å: ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

4. ‚ö†Ô∏è **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã –æ—Ç CSRF –≤ OAuth2 flow**
   - –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ state –ø–∞—Ä–∞–º–µ—Ç—Ä–∞

### Low (P3)
1. ‚ö†Ô∏è **CORS misconfiguration**
   - –ü—Ä–æ–±–ª–µ–º–∞: CORS –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç whitelist origins –¥–ª—è –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö origins
   - –†–∏—Å–∫: –ù–∏–∑–∫–∏–π, –Ω–æ –º–æ–∂–µ—Ç —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
   - –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É CORS –≤ NestJS
   - –°—Ç–∞—Ç—É—Å: ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

2. ‚ö†Ô∏è **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã –æ—Ç brute force –Ω–∞ 2FA**
   - –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## ‚úÖ –ü—Ä–æ–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –£—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω–æ
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Brute force protection —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Security headers –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- ‚úÖ JWT –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Service authentication —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Enumeration attack protection —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è password reset
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–∞

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–æ–∫:** 80+
- **–ü—Ä–æ–π–¥–µ–Ω–æ:** 70+
- **–¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:** 5+
- **–ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º:**
  - Critical (P0): 1 (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
  - High (P1): 2 (1 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, 1 —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π - –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  - Medium (P2): 4 (2 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, 1 –Ω–∞–π–¥–µ–Ω–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏, 1 —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏)
  - Low (P3): 2

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-17
