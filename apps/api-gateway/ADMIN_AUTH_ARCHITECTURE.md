# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–æ–≤ Gateway

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ –ß—Ç–æ –µ—Å—Ç—å:
- –ú–æ–¥–µ–ª—å `GatewayAdmin` –≤ Gateway –ë–î —Å `passwordHash` (bcrypt)
- –ú–æ–¥–µ–ª–∏ `GatewayAdminSession` –∏ `GatewayAuditLog` –¥–ª—è —Å–µ—Å—Å–∏–π –∏ –∞—É–¥–∏—Ç–∞
- –ê–¥–º–∏–Ω—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ—É—Ç–∏–Ω–≥–æ–º –∏ whitelist
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `JwtGuard` (–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤)

### ‚ùå –ß—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:
- –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–æ–≤ (`POST /api/v1/admin/auth/register`)
- –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ª–æ–≥–∏–Ω–∞ –∞–¥–º–∏–Ω–æ–≤ (`POST /api/v1/admin/auth/login`)
- –û—Ç–¥–µ–ª—å–Ω–∞—è JWT —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- Guard –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤

## üèóÔ∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Big Tech –ø–æ–¥—Ö–æ–¥)

### 1. –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (—Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ):**
- –ê–¥–º–∏–Ω—ã –≤ Gateway –ë–î (`workix_gateway`)
- –ü–∞—Ä–æ–ª–∏ –≤ —Ç–æ–π –∂–µ –ë–î, —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ bcrypt
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Gateway –≤ —Ç–æ–π –∂–µ –ë–î

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
- **–ò–∑–æ–ª—è—Ü–∏—è**: –ê–¥–º–∏–Ω—ã Gateway –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –ë–î
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –û—Ç–¥–µ–ª—å–Ω–∞—è –ë–î = –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: Gateway –ë–î –ª–µ–≥—á–µ, –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: Gateway –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –µ—Å–ª–∏ auth —Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–ö–∞–∫ –¥–µ–ª–∞—é—Ç Big Tech:**
- **AWS API Gateway**: –û—Ç–¥–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ IAM, –∞–¥–º–∏–Ω—ã —á–µ—Ä–µ–∑ AWS IAM
- **Kong Gateway**: –ê–¥–º–∏–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –ë–î Kong, –æ—Ç–¥–µ–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **Istio**: Kubernetes service accounts, –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Kubernetes**: Service accounts –≤ etcd, –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

**–û—Ç–¥–µ–ª—å–Ω–∞—è JWT —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤:**
- –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ–∫—Ä–µ—Ç –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö JWT (`GATEWAY_ADMIN_JWT_SECRET`)
- –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã (–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ)
- –û—Ç–¥–µ–ª—å–Ω—ã–π Guard (`AdminJwtGuard`)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
```
POST /api/v1/admin/auth/register  - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–¥–º–∏–Ω–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è super_admin)
POST /api/v1/admin/auth/login     - –õ–æ–≥–∏–Ω –∞–¥–º–∏–Ω–∞
POST /api/v1/admin/auth/refresh   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
POST /api/v1/admin/auth/logout   - –í—ã—Ö–æ–¥
GET  /api/v1/admin/auth/me        - –¢–µ–∫—É—â–∏–π –∞–¥–º–∏–Ω
```

### 3. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–¥–º–∏–Ω–æ–≤

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
1. **–ß–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏—é/seed** (–¥–ª—è –ø–µ—Ä–≤–æ–≥–æ super_admin)
2. **–ß–µ—Ä–µ–∑ CLI –∫–æ–º–∞–Ω–¥—É** (–¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∞–¥–º–∏–Ω–æ–≤)
3. **–ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** (—Ç–æ–ª—å–∫–æ –¥–ª—è super_admin)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ö–æ–º–±–∏–Ω–∞—Ü–∏—è 1 + 2:
- –ü–µ—Ä–≤—ã–π super_admin —á–µ—Ä–µ–∑ seed/migration
- –û—Å—Ç–∞–ª—å–Ω—ã–µ —á–µ—Ä–µ–∑ CLI –∏–ª–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—Ç–æ–ª—å–∫–æ super_admin –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å)

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ü–∞—Ä–æ–ª–∏:**
- ‚úÖ –•—Ä–∞–Ω–∏—Ç—å –≤ Gateway –ë–î (bcrypt)
- ‚úÖ –û—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ 12 —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Å–º–µ–Ω–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–°–µ—Å—Å–∏–∏:**
- ‚úÖ –•—Ä–∞–Ω–∏—Ç—å –≤ `GatewayAdminSession`
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã —Å –∫–æ—Ä–æ—Ç–∫–∏–º TTL (15-30 –º–∏–Ω—É—Ç)
- ‚úÖ Refresh tokens —Å –¥–ª–∏–Ω–Ω—ã–º TTL (7 –¥–Ω–µ–π)
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ IP –∏ User-Agent

**–ê—É–¥–∏—Ç:**
- ‚úÖ –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ `GatewayAuditLog`
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ IP, User-Agent, –≤—Ä–µ–º–µ–Ω–∏

## üìù –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω—Å–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
1. –°–æ–∑–¥–∞—Ç—å `AdminAuthService` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–¥–º–∏–Ω–∞–º–∏
2. –°–æ–∑–¥–∞—Ç—å `AdminJwtService` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞–¥–º–∏–Ω—Å–∫–∏—Ö JWT
3. –°–æ–∑–¥–∞—Ç—å `AdminJwtGuard` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤
4. –°–æ–∑–¥–∞—Ç—å `AdminAuthController` —Å —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–ª–æ–≥–∏–Ω–∞

### –≠—Ç–∞–ø 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
1. –ó–∞–º–µ–Ω–∏—Ç—å `JwtGuard` –Ω–∞ `AdminJwtGuard` –≤ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö
2. –û–±–Ω–æ–≤–∏—Ç—å Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### –≠—Ç–∞–ø 3: –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞
1. –°–æ–∑–¥–∞—Ç—å seed —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ super_admin
2. –î–æ–±–∞–≤–∏—Ç—å CLI –∫–æ–º–∞–Ω–¥—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–æ–≤

## üîê –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

| –ê—Å–ø–µ–∫—Ç | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (Auth Service) | –ê–¥–º–∏–Ω—ã (Gateway) |
|--------|----------------------------|------------------|
| –ë–î | `workix_auth` | `workix_gateway` |
| –°–µ—Ä–≤–∏—Å | `api-auth:7102` | `api-gateway:7000` |
| JWT Secret | `JWT_SECRET` | `GATEWAY_ADMIN_JWT_SECRET` |
| Guard | `JwtGuard` | `AdminJwtGuard` |
| –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è | –ü—É–±–ª–∏—á–Ω–∞—è | –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–æ–≤/CLI |
| –†–æ–ª–∏ | RBAC –≤ monolith | `admin`, `super_admin` |

## ‚úÖ –í—ã–≤–æ–¥—ã

**–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è:**
- ‚úÖ –ê–¥–º–∏–Ω—ã –≤ Gateway –ë–î - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ü–∞—Ä–æ–ª–∏ –≤ Gateway –ë–î - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –û—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- ‚ùå –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–ª–æ–≥–∏–Ω–∞ –∞–¥–º–∏–Ω–æ–≤
- ‚ùå –û—Ç–¥–µ–ª—å–Ω–∞—è JWT —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- ‚ùå Guard –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤

**–≠—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç best practices Big Tech:**
- –ò–∑–æ–ª—è—Ü–∏—è –∞–¥–º–∏–Ω–æ–≤ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û—Ç–¥–µ–ª—å–Ω–∞—è –ë–î –¥–ª—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û—Ç–¥–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
