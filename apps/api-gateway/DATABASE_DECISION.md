# üóÑÔ∏è –†–µ—à–µ–Ω–∏–µ –ø–æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è API Gateway

**–î–∞—Ç–∞:** 2025-01-XX
**–†–µ—à–µ–Ω–∏–µ:** PostgreSQL –¥–ª—è API Gateway

---

## üìã –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î Gateway:

1. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤**
   - URLs –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
   - –ü–æ—Ä—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤
   - –í–µ—Ä—Å–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
   - Fallback URLs

2. **–°—Ç–∞—Ç—É—Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤**
   - Health checks
   - Response time
   - Last checked timestamp
   - Error messages

3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏**
   - Endpoint whitelist
   - Rate limits
   - Allowed methods
   - Allowed versions

4. **API –∫–ª—é—á–∏**
   - –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ API keys (bcrypt hash)
   - Expiration dates
   - Usage tracking

5. **–ê–¥–º–∏–Ω—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** (–æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç api-auth)
   - –ê–¥–º–∏–Ω—Å–∫–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
   - –°–µ—Å—Å–∏–∏
   - Audit logs

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: PostgreSQL

### –ü–æ—á–µ–º—É PostgreSQL, –∞ –Ω–µ MongoDB?

#### ‚úÖ PostgreSQL –ø–æ–¥—Ö–æ–¥–∏—Ç –ª—É—á—à–µ:

1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –∏–º–µ–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
   - –†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –∏–¥–µ–∞–ª—å–Ω–∞ –¥–ª—è —Å–≤—è–∑–µ–π (—Å–µ—Ä–≤–∏—Å—ã ‚Üí –≤–µ—Ä—Å–∏–∏ ‚Üí health checks)

2. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ã–º
   - –ù—É–∂–Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

3. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
   - –ê–¥–º–∏–Ω—Å–∫–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ä–æ–ª–∏, —Å–µ—Å—Å–∏–∏ ‚Äî –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
   - –°–≤—è–∑–∏ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ (audit logs)

4. **–ï–¥–∏–Ω–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞**
   - Prisma —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ
   - –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
   - –ü—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

5. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - –î–ª—è gateway –Ω–µ –Ω—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏ (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–µ–Ω—è–µ—Ç—Å—è —Ä–µ–¥–∫–æ)
   - –ß—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
   - PostgreSQL –æ—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å —á–∞—Å—Ç—ã–º–∏ —á—Ç–µ–Ω–∏—è–º–∏

#### ‚ùå MongoDB –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç:

1. **–ì–∏–±–∫–∞—è —Å—Ö–µ–º–∞ –Ω–µ –Ω—É–∂–Ω–∞** ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è
2. **–î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –ø–æ–¥—Ö–æ–¥—è—Ç** ‚Äî –Ω—É–∂–Ω—ã —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏
3. **–í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞** ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–µ–¥–∫–æ

---

## üóÑÔ∏è –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** `workix_gateway`
**–ü–æ—Ä—Ç:** `5100` (API 7100 ‚Üí DB 5100, –ø—Ä–∞–≤–∏–ª–æ: 7‚Üí5)

### –ú–æ–¥–µ–ª–∏:

1. **GatewayServiceConfig** ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
2. **GatewayServiceVersion** ‚Äî –≤–µ—Ä—Å–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
3. **GatewayHealthCheck** ‚Äî —Å—Ç–∞—Ç—É—Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
4. **GatewayApplication** ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–¥–ª—è rate limiting)
5. **GatewayEndpointWhitelist** ‚Äî whitelist —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
6. **GatewayApiKey** ‚Äî API –∫–ª—é—á–∏
7. **GatewayAdmin** ‚Äî –∞–¥–º–∏–Ω—Å–∫–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
8. **GatewayAdminSession** ‚Äî —Å–µ—Å—Å–∏–∏ –∞–¥–º–∏–Ω–æ–≤
9. **GatewayAuditLog** ‚Äî –ª–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–æ–≤

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î:

- URLs —Å–µ—Ä–≤–∏—Å–æ–≤ (–ø—É–±–ª–∏—á–Ω—ã–µ)
- –ü–æ—Ä—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤
- –í–µ—Ä—Å–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
- Health check —Å—Ç–∞—Ç—É—Å—ã

### ‚ö†Ô∏è –•—Ä–∞–Ω–∏—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏:

- API keys (bcrypt hash)
- –ü–∞—Ä–æ–ª–∏ –∞–¥–º–∏–Ω–æ–≤ (bcrypt hash)
- JWT tokens (hash)

### ‚ùå –ù–ï —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î:

- Service-to-service credentials (–≤ secrets manager)
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ (–≤ secrets manager)

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Connection String:

```bash
DATABASE_URL_GATEWAY=postgresql://postgres:postgres@localhost:5100/workix_gateway
```

### In-Memory Cache:

Gateway –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **in-memory cache** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –ë–î –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ Admin API
- Fallback –Ω–∞ –ë–î –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ

### Health Checks:

- –°—Ç–∞—Ç—É—Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏
- –•—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

---

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

1. ‚úÖ **–ï–¥–∏–Ω–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞** ‚Äî PostgreSQL + Prisma –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
2. ‚úÖ **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** ‚Äî –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. ‚úÖ **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** ‚Äî –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
4. ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ + –±—ã—Å—Ç—Ä—ã–µ —á—Ç–µ–Ω–∏—è –∏–∑ –ë–î
5. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –∏–∑–æ–ª—è—Ü–∏—è –∞–¥–º–∏–Ω—Å–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –æ—Ç api-auth

---

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –°–æ–∑–¥–∞–Ω Prisma schema
2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω docker-compose.yml
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ—Ä—Ç–æ–≤
4. ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Prisma client –≤ gateway
5. ‚è≥ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥–º–∏–Ω—Å–∫—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
6. ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ë–î —Å ServiceRoutingService
