<div class="builder-container">
  <workix-pipeline-builder
    [config]="pipelineBuilderConfig()"
    [isLoading]="isSaving()"
    (onSave)="savePipeline()"
    (onCancel)="cancel()"
    (onAddStep)="addStep()"
    (onStepClick)="editStep($event)"
    (onStepSave)="saveStepConfig($event)"
    (onStepDelete)="deleteStepConfig()"
  >
    <!-- Pipeline Details Form -->
    <form [formGroup]="form" class="pipeline-form">
      <workix-input
        label="Pipeline Name"
        formControlName="name"
        placeholder="Enter pipeline name"
        [required]="true"
      />
      <workix-input
        label="Description"
        formControlName="description"
        type="textarea"
        rows="3"
        placeholder="Enter description"
      />
      <workix-input
        label="Schedule (Cron)"
        formControlName="schedule"
        placeholder="e.g., 0 0 * * * (daily at midnight)"
      />
      <workix-input label="Timeout (seconds)" formControlName="timeout" type="number" [min]="1" />
    </form>

    <!-- Steps List -->
    @if (steps().length === 0) {
    <p class="no-steps">No steps yet. Add one from the toolbar above.</p>
    } @else {
    <workix-list>
      @for (step of steps(); track step.id; let i = $index) {
      <workix-list-item>
        <workix-icon [name]="getStepIcon(step.type)" [size]="'md'" />
        <div class="step-info">
          <div class="step-name">{{ step.name }}</div>
          <div class="step-type">{{ step.type }} â€¢ Step {{ i + 1 }}</div>
        </div>
        <workix-button variant="icon" icon="edit" (onClick)="editStep(step)" />
        <workix-button variant="icon" icon="delete" (onClick)="deleteStep(step.id)" />
      </workix-list-item>
      }
    </workix-list>
    }

    <!-- Step Editor -->
    @if (selectedStep()) {
    <workix-step-editor
      [step]="selectedStep()!"
      [config]="stepEditorConfig()"
      (onSave)="saveStepConfig($event)"
      (onDelete)="deleteStepConfig()"
    />
    }

    <!-- Canvas -->
    <workix-canvas [steps]="steps()" [config]="canvasConfig()" (onStepClick)="editStep($event)" />
  </workix-pipeline-builder>
</div>
