# üõ°Ô∏è Security and Injection Tests for API Auth Service

## üìã –û–±–∑–æ—Ä

–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ E2E —Ç–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞—â–∏—Ç—ã –æ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∞—Ç–∞–∫ –∏ –∏–Ω—ä–µ–∫—Ü–∏–π –≤ `api-auth` —Å–µ—Ä–≤–∏—Å–µ.

## üß™ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

### 1. SQL Injection Protection
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π –≤ email –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π –≤ email –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π –≤ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π –≤ email –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –ø–∞—Ä–æ–ª—è

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ SQL payloads —Å –∫–æ–¥–æ–º 400
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ SQL –æ—à–∏–±–æ–∫ –≤ –æ—Ç–≤–µ—Ç–∞—Ö
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î

### 2. XSS (Cross-Site Scripting) Protection
- ‚úÖ –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è XSS –≤ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è XSS –≤ email –ø–æ–ª–µ

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ XSS payloads
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ script —Ç–µ–≥–æ–≤ –≤ –æ—Ç–≤–µ—Ç–∞—Ö
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ javascript: –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –≤ –æ—Ç–≤–µ—Ç–∞—Ö

### 3. Command Injection Protection
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–∏ –∫–æ–º–∞–Ω–¥ –≤ email
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–∏ –∫–æ–º–∞–Ω–¥ –≤ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ command injection payloads
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ –≤ –æ—Ç–≤–µ—Ç–∞—Ö

### 4. Path Traversal Protection
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç path traversal –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö user ID

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ path traversal payloads
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∏—Å—Ç–µ–º–Ω—ã–º —Ñ–∞–π–ª–∞–º

### 5. Email Injection Protection
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç CRLF –∏–Ω—ä–µ–∫—Ü–∏–π –≤ email
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç header –∏–Ω—ä–µ–∫—Ü–∏–π –≤ password reset

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ CRLF —Å–∏–º–≤–æ–ª–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—ä–µ–∫—Ü–∏–∏ email –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è email —Ñ–æ—Ä–º–∞—Ç–∞

### 6. Brute Force Protection
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø–æ—Å–ª–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- ‚úÖ Rate limiting –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ –ª–æ–≥–∏–Ω–∞

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ (423 Locked)
- Rate limiting (429 Too Many Requests)
- –°—á–µ—Ç—á–∏–∫ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

### 7. Email Enumeration Protection
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è email –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è email –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –ø–∞—Ä–æ–ª—è

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö/–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö email
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–∏ email
- –ó–∞—â–∏—Ç–∞ –æ—Ç timing –∞—Ç–∞–∫

### 8. JWT Token Security
- ‚úÖ –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö JWT —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ —Å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º "none"
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç replay –∞—Ç–∞–∫

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–æ–∫–µ–Ω–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø–æ–¥–ø–∏—Å–∏
- Blacklist –º–µ—Ö–∞–Ω–∏–∑–º

### 9. Input Validation
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ email
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–∏–ª—ã –ø–∞—Ä–æ–ª—è
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö email
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è

### 10. 2FA Brute Force Protection
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç brute force –Ω–∞ 2FA –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ—Å–ª–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- Rate limiting –Ω–∞ 2FA —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö

### 11. OAuth2 Security
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è state –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π —Å callback

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è state –≤ OAuth flow
- –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫
- –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö callbacks

### 12. Information Disclosure
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ—à–∏–±–æ–∫
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ stack traces –≤ production

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–µ—Ç–∞–ª–µ–π –ë–î –≤ –æ—à–∏–±–∫–∞—Ö
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ stack traces
- –û–±—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### 13. Authorization Bypass
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **PostgreSQL** –Ω–∞ –ø–æ—Ä—Ç—É 5102 (workix_auth)
2. **Redis** –Ω–∞ –ø–æ—Ä—Ç—É 5900
3. **API Auth —Å–µ—Ä–≤–∏—Å** –Ω–∞ –ø–æ—Ä—Ç—É 7102

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ë–î –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å
npm run test:auth:e2e:security
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ë–î
npm run test:auth:e2e:db

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
npm run test:auth:e2e:service

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
vitest run apps-e2e/src/auth/security-injection.spec.ts --config apps-e2e/vitest.config.auth.ts
```

### Watch —Ä–µ–∂–∏–º

```bash
npm run test:auth:e2e:security:watch
```

## üìä Payloads –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### SQL Injection
- `' OR '1'='1`
- `' UNION SELECT * FROM users --`
- `'; DROP TABLE users; --`

### XSS
- `<script>alert("XSS")</script>`
- `<img src=x onerror=alert("XSS")>`
- `javascript:alert("XSS")`

### Command Injection
- `; ls -la`
- `| cat /etc/passwd`
- `$(ls -la)`

### Path Traversal
- `../../../etc/passwd`
- `..%2f..%2f..%2fetc%2fpasswd`

### Email Injection
- `test%0d%0a@example.com`
- `test%0d%0aSubject:%20test@example.com`

## ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã:
- ‚úÖ –û—Ç–∫–ª–æ–Ω—è—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ payloads
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ HTTP –∫–æ–¥—ã (400, 401, 403, 404, 429, 423)
- ‚úÖ –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- ‚úÖ –ù–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∏–Ω—ä–µ–∫—Ü–∏–∏
- ‚úÖ –ó–∞—â–∏—â–∞—Ç—å –æ—Ç brute force –∞—Ç–∞–∫

## üìù –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

–°–º. `apps/api-auth/TESTING_RESULTS.md` –¥–ª—è —Å–ø–∏—Å–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `apps/api-auth/TESTING_RESULTS.md` - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `apps/api-auth/TESTING_PENDING.md` - –ù–µ–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—É–Ω–∫—Ç—ã
- `apps/api-auth/SECURITY_SYSTEM_ARCHITECTURE.md` - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
2. ‚è≥ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
3. ‚è≥ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
4. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
